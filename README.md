# Grid Weblets
![Version: 1.0.0](https://img.shields.io/badge/Version-1.0.0-informational?style=flat-square)

A svelte[^1] project for creating web components - which are reusable custom elements with their functionality encapsulated away from the rest of the code â€” that interact with TF Grid 3 and could be utilized from other web apps.

It solves such problem where you had to write complex HTML (and associated style and script) to render custom UI controls (eg, to deploy some workload on the TF Grid 3), and how using them multiple times in different projects can be a miss if you are not careful.

[^1]: In case you wonder what is [svelte](https://github.com/sveltejs/svelte), It's a compiler that takes your declarative components and converts them into efficient JavaScript that surgically updates the DOM. if your are interested to learn more about Sevlte and how to get started with it you can check this [tutorial](https://developer.mozilla.org/en-US/docs/Learn/Tools_and_testing/Client-side_JavaScript_frameworks/Svelte_getting_started)

## The Contents
  - [Getting Started](#getting-started)
    - [Prerequisites](#prerequisites)
    - [Installation](#installation)
    - [Run The Playground](#run-the-playground)
  - [Elements](#elements)
    - [Kubernetes](#kubernetes)
    - [Virtual Machine](#virtual-machine)
    - [Caprover](#caprover)
    - [Deployed List](#deployed-list)
  - [Add New Weblet](#add-new-weblet)
  - [Playground](#playground)
  - [Add Weblet To Plain HTML File](#add-weblet-to-plain-html-file)
  - [Test a weblet](#test-a-weblet)
    - [Create](#create)
    - [Build](#build)
    - [Use](#use)

## Getting Started
In order to work with this project you need to have `Node.js` installed. It's recommended that you use the Active long-term support (LTS) version 16. Node includes `npm` (the node package manager), and `npx` (the node package runner). Note that it is recommended to use the Yarn package manager in place of npm, we'll assume you are using `yarn` in these Docs.

### Prerequisites
- Node.js >= 14
- Yarn
- development tools: gcc g++ make libtool
  
If your are using Debian based OS you can follow the below instructions to install the prerequisites.

```sh
# install Node.js 16 (Active LTS)
curl -fsSL https://deb.nodesource.com/setup_16.x | sudo -E bash -
sudo apt-get install -y nodejs
# install Yarn
curl -sL https://dl.yarnpkg.com/debian/pubkey.gpg | gpg --dearmor | sudo tee /usr/share/keyrings/yarnkey.gpg >/dev/null
echo "deb [signed-by=/usr/share/keyrings/yarnkey.gpg] https://dl.yarnpkg.com/debian stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
sudo apt-get update && sudo apt-get install yarn
# this would be required for building some optional dependencies 
sudo apt-get install libtool gcc g++ make
```

You can see the following for more information about installing other versions of Node.js :
  [install Node.js on Debian and Ubuntu based distributions](https://github.com/nodesource/distributions/blob/master/README.md)


### Installation


https://user-images.githubusercontent.com/31689104/149097600-be76b899-32a7-498d-96b8-b645a54a2232.mp4




- **Clone the repo**
  ```
  git clone https://github.com/threefoldtech/grid_weblets.git
  ```
- **Install the dependencies**
  
  The project contains lock files generated by tools other than Yarn. It is advised not to mix package managers in order to avoid resolution inconsistencies caused by unsynchronized lock files. TO avoid any issues with package managers other than `npm` remove `package-lock.json`.
  ```sh
  cd grid_weblets/
  # we gonna use yarn so it's recommended to remove npm lock file or rename it
  rm package-lock.json
  # install project dependencies
  yarn install
  cd easy-docs/ && yarn install
  cd ..
  ```
- **Compile**
  ```sh
  yarn build:app
  ```

  *JavaScript heap out of memory error:*

    In some cases you could see an error like this: `FATAL ERROR: Reached heap limit Allocation failed - JavaScript heap out of memory`

    As Rollup needs to keep all module information in memory simultaneously to be able to analyze relevant side effects for tree-shaking, it is possible that bundling large projects reaches Node's memory limit. If this happens, it can help to increase this limit by running Rollup via

     ```sh
     export NODE_OPTIONS="--max-old-space-size=2048" # or even higher size 8192
     yarn build:app # on grid_weblets (dir)
     ```
    Increasing --max-old-space-size as needed. Note that this number can safely surpass your available physical memory. In that case, Node will start paging memory to disk as needed.
    
### Run The Playground
  Finally to run the playground, you need to serve the bundle created in docs directory, for that you could use `serve`
```sh
npx serve docs
```  
you could then access open this link in your browser http://localhost:3000



## Elements
### Kubernetes
```html
<tf-kubernetes></tf-kubernetes>
```
![image](https://user-images.githubusercontent.com/31689104/140759704-983816c3-2a01-4da8-90bb-fee3f9928f7e.png)

### Virtual Machine
```html
<tf-vm></tf-vm>
```
![image](https://user-images.githubusercontent.com/31689104/140759788-c9403c04-2d83-493f-9124-2af191b82a4a.png)

### Caprover
```html
<tf-caprover></tf-caprover>
```
![image](https://user-images.githubusercontent.com/31689104/140759852-e056e5bb-bcc7-4096-9b7c-7110afc05284.png)

### Deployed List
```html
<tf-deployedlist></tf-deployedlist> <!-- to show all tabs -->
<!-- Accept tab attribute      tab =  'vm' | 'k8s' | 'caprover' -->
<tf-deployedlist tab="k8s"></tf-deployedlist>
<tf-deployedlist tab="vm"></tf-deployedlist>
<tf-deployedlist tab="caprover"></tf-deployedlist>
```
![image](https://user-images.githubusercontent.com/31689104/140760029-634e5e14-ac83-4caf-ad3e-75c66edbdf18.png)
![image](https://user-images.githubusercontent.com/31689104/140760540-a0475e07-14d7-4daa-a728-5babf32bc8d4.png)


## Add New Weblet
We are going to add new weblet called `demo` .

1. Add new folder called **demo** at `src/elements/demo` .
2. Add **Demo.wc.svelte** at `src/elements/demo/Demo.wc.svelte` .
3. Add **index.ts** at `src/elements/demo/index.ts` .

```ts
// index.ts

// import *demo* component
import Demo from './Demo.wc.svelte';

// import *defineElement* library
import defineElement from '../../utils/defineElement';


// Register new wc
defineElement('demo', Demo); // tf-demo
```

```ts
// Demo.wc.svelte

/* Write whatever svelte code u need here */
```
> Find More About svelte [here](https://svelte.dev/docs) .


4. Developing weblet by importing `Demo.wc.svelte` into `App.svelte`.

```html
<!-- App.svelte -->
<script lang="ts">
    import Demo from './elements/demo/Demo.wc.svelte';
</script>

<Demo />
```
```sh
yarn dev
```

5. Build `Demo.wc.svelte`.
```sh
yarn build
```



## Playground

- `cd easy-docs`
- `yarn build`  will output in the docs directory
- serve content in docs dir for path `/grid_weblets` so `play.grid.tf/grid_weblets`

## Add Weblet To Plain HTML File
Assume we need to include `vm` weblet in its own `index.html` file.  
The `index.html` file should be like the following.
> Notes: Your will need to include `base.wc.js` & `profiles.wc.js` for every component to work also you will need to inject the required libraries [grid3_client](https://www.npmjs.com/package/grid3_client) and [ts-rmb-http-client](https://www.npmjs.com/package/ts-rmb-http-client) in `window.configs` Object.

```html
<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VM Weblet Example</title>

    <style>
      * {
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      }
    </style>

    <script src="/path/to/libs/to/inject"></script>
    <!-- window.configs should include the required libs -->

    <script src="/path/to/base.wc.js"></script>
    <script src="/path/to/profiles.wc.js"></script>
    <script defer src="/path/to/vm.wc.js"></script>
</head>
<body>
    <tf-base></tf-base>
    <tf-profiles></tf-profiles>
    <tf-vm></tf-vm>
</body>
</html>
```


## Test a weblet

### Create

- Add new folder for your weblet as `src/elements/demo`
- Import `Demo.wc` svelte into `App.svelte`
- Add your weblet on elements list in `easy-docs/src/App.vue`
- Append a weblet in `easy-docs/src/views/Editor.vue` by appending the weblets list

### Build

- Make sure to install dependencies in both `/` and `/easy-docs` by running `yarn`
- `yarn serve:app`

### Use

- In profile Tab, Create or Load your profile
- Begin to Deploy your weblet
- List the info to access weblet
